---
title: "engineering the perfect group chat (part 2)"
date: "2025-01-21"
readingTimeMin: 10
meta:
  "og:title": "engineering the perfect group chat (part 2)"
  og:description: "how i replicated apple's imessage ui in an autonomous group chat"
  og:image: "/group-chat/og.png"
  twitter:image: "/group-chat/og.png"
  twitter:card: "summary_large_image"
  twitter:title: "engineering the perfect group chat (part 2)"
  twitter:description: "how i replicated apple's imessage ui in an autonomous group chat"
---

last week, i launched a fun project that lets you chat with ai personas in a group chat setting that
both looks and feels remarkably similar to imessage. in [part 1](/blog/group-chat), i walked through
how i built the backend to make the ai personas chat autonomously and mimic the dynamics of a real
group chat. in this post, we'll switch gears and focus on the frontend and dive into the design and
technical details behind this imessage-inspired interface.

## why imessage?

imessage is beloved for its sleek, bubbly design. there are so many tiny details that make it so
satisfying to use. i wanted to replicate them as closely as possible:

- **message bubbles**: the message bubbles have a dynamic, adaptive color that subtly shifts based
  on their position on the screen.
- **frosted glass effect**: the header and footer have a semi-transparent, blurred look that allows
  content behind it to subtly show through, giving a sense of depth while maintaining readability.
- **reactions**: the familiar heart, like, dislike, laugh, emphasize, and question reactions animate
  in and out.
- **mentions**: @-mentions turn bright blue with a subtle bounce when a participant's name is typed.
- fun sounds and animations sprinkled throughout

it wasn‚Äôt until i tried building these elements from scratch that i fully grasped how much is
happening under the hood. each detail requires a good amount of frontend trickery - from carefully
placed gradients and custom scroll bars to svg masks and rich text editors.

## quick component overview

in this post, we'll mainly focus on four core components:

- **chat area**: a top-level container that includes all of the components below
- **chat header**: the top part of the chat area, showing the conversation's participants
- **message list**: the scrollable body, where messages and reactions appear
- **message input**: a text editor for typing new messages, including @-mentions

<img src="/group-chat-2/layout.png" alt="layout" />

## message bubbles

one of the harder parts of replicating imessage was getting the signature blue bubbles just right.
you've probably noticed that messages near the top of the screen look lighter and those near the
bottom look darker. that‚Äôs because there's a very subtle gradient that shifts with your scroll
position.

<img src="/group-chat-2/gradient.png" alt="gradient" />

to create this gradient effect, i used a technique inspired by
[lucas bebber](https://x.com/lucasbebber) (found on
[codepen](https://codepen.io/lbebber/pen/RVegdO)). here's how it works:

1. there's a large gradient background in the chat area itself:

```typescript
<div
  className={cn(
    "absolute inset-0 bg-gradient-to-b from-[#43CDF6] to-[#0A7CFF]",
    isMobileView ? "top-24" : "top-16",
    "bottom-16"
  )}
/>
```

2. each bubble uses an svg-based border for its outline and tail, combined with a pseudo element
   that has the same gradient pinned with `background-attachment: fixed`. the border is white
   (`#FFFFFF`) in light mode and dark gray (`#1A1A1A`) in dark mode, so it gives the illusion that
   the message bubble is just sitting on top of the background. for messages from the user, a
   transparent center that acts like a window. the fixed gradient doesn't scroll with the rest of
   the page, so the bubble shows lighter blue near the top and gradually shifts to a deeper blue as
   you scroll down.

```typescript
isMe ? "border-[17px] border-solid border-r-[22px] text-white
before:content-[''] before:absolute before:inset-[-17px] before:bg-[linear-gradient(#43CDF6,#0A7CFF)]
before:bg-fixed before:-z-10"
```

- `before:content-['']` creates an empty `::before` pseudo element
- `before:absolute before:inset-[-17px]` expands it beyond the bubble‚Äôs box, so it covers more area
  behind the bubble shape
- `before:bg-[linear-gradient(#43CDF6,#0A7CFF)] before:bg-fixed` sets the same blue gradient (from
  the chat area) and pins it to the viewport with `background-attachment: fixed`
- placing it behind the bubble (`before:-z-10`) ensures it shows through the transparent portion of
  the svg outline.

3. for messages from the other participants, the svg mask is given a center that is light gray
   (`#F3F4F6`) in light mode and dark gray (`#404040`) in dark mode.

4. the typing indicator follows the same pattern with the typing bubble shape instead of the message
   tail. at first, it‚Äôs displayed with some placeholder dots that are animated to blink from left to
   right as the recipient types. after the typing delay, the typing bubble switches to a message
   bubble with the content inside.

<img src="/group-chat-2/bubbles.png" alt="message bubbles" />

5. the reactions are a bit trickier. each reaction icon is masked via `webkitmaskimage` or
   `maskimage`, then filled with the fixed gradient. the result is that each reaction bubble
   displays the same fixed gradient behind the scenes, giving them the same color variation as the
   main message bubbles. without the pseudo elements,
   [mobile browsers struggle with fixed backgrounds](https://www.reddit.com/r/csshelp/comments/1cefzv4/trying_to_get_a_fixed_background_on_mobile/).

```typescript
style={{
  ...(reaction.sender === "me"
    ? {
        WebkitMaskImage: `url('${getReactionIconSvg(isMe, reaction.type)}')`,
        maskImage: `url('${getReactionIconSvg(isMe, reaction.type)}')`,
        WebkitMaskSize: "contain",
        maskSize: "contain",
        WebkitMaskRepeat: "no-repeat",
        maskRepeat: "no-repeat",
        WebkitMaskPosition: "center",
        maskPosition: "center",
        background: "linear-gradient(to bottom, #43CDF6, #0A7CFF)",
        backgroundAttachment: "fixed",
      }
    : {
        backgroundImage: `url('${getReactionIconSvg(isMe, reaction.type)}')`,
        backgroundSize: "contain",
        backgroundRepeat: "no-repeat",
        backgroundPosition: "center",
      }),
}}
```

once the gradients, masks, and pseudo elements are all in place, we get the dynamic, imessage-style
effect: your own messages look light at the top, deeper blue at the bottom, and all the reaction
icons are seamlessly tinted to match.

there is zero chance i would have figured this part out without the help of
[eden](https://x.com/eden_halperin) and [john](https://x.com/JohnPhamous) ü´∂üèº

## the frosted glass effect

the "frosted glass" effect is another important part of imessage's look and feel. essentially, the
chat header and message input have a semi-transparent, blurred look that allows the message list
content behind them to subtly show through like "frosted glass".

<div style={{ marginBlock: "1rem" }}>
  <video
    src="/group-chat-2/scroll.mp4"
    autoPlay
    loop
    muted
    playsInline
    style={{ width: "100%", display: "block", borderRadius: "0.5rem" }}
  />
</div>

the trick to creating this effect is to use absolute positioning to position the chat header and
message input on top of the message list, then add margins to the scrollbar to make it appear as if
the message list is in between them.

```typescript
export function ChatArea() {
  return (
    <div className="h-dvh relative">
      <div className="absolute top-0 left-0 right-0 z-50 bg-background/50 backdrop-blur-md">
        <ChatHeader />
      </div>
      <div
        className={cn(
          "absolute inset-0 bg-gradient-to-b from-[#43CDF6] to-[#0A7CFF]",
          isMobileView ? "top-24" : "top-16",
          "bottom-16"
        )}
      />
      <ScrollArea withVerticalMargins bottomMargin="calc(var(--dynamic-height, 64px))">
        <div className="pb-[var(--dynamic-height,64px)]">
          <div className="flex-1 relative">
            <div className="relative h-full flex">
              <div className="w-3 bg-background" />
              <MessageList />
              <div className="w-3 bg-background" />
            </div>
          </div>
        </div>
      </ScrollArea>
      <div className="absolute bottom-0 left-0 right-0 z-50 bg-background/50 backdrop-blur-md h-[var(--dynamic-height,64px)]">
        <MessageInput />
      </div>
    </div>
  );
}
```

- `bg-background/50` and `backdrop-blur-md` applies the translucent background and blur effect to
  the chat header and message input components.
- `z-50` ensures these frosted panels appear above the message list content.
- `withVerticalMargins` adds a margin to the top and bottom of the scrollbar so that it doesn't get
  hidden behind the chat header and message input.
- `--dynamic-height` is used to offset the height of the message input for multi-line messages.

by combining these blur styles with the vibrant blue bubbles from underneath, we get a realistic
apple-style translucent header and footer. it‚Äôs a small detail, but does a lot to contribue to the
overall imessage look and feel.

## reactions

another hallmark of imessage is the reactions. at a glance, the reactions seem pretty simple, but
like most of the project, gave me a bit of trouble.

<div style={{ marginBlock: "1rem" }}>
  <video
    src="/group-chat-2/reactions.mp4"
    autoPlay
    loop
    muted
    playsInline
    style={{ width: "100%", display: "block", borderRadius: "0.5rem" }}
  />
</div>

there are a few factors that determine how a reaction looks and behaves:

- **type**: heart, like, dislike, laugh, question, and emphasize.

- **orientation**: if the reaction is attached to a message from you, the little ‚Äútail‚Äù of the
  reaction points to the left. if the reaction is attached to a message from another recipient, the
  tail points to the right. the orientation essentially mirrors the orientation of the message to
  which it's applied.

- **color**: if you are the one reacting, the reaction bubble is blue. if it‚Äôs another participant,
  the reaction bubble matches the color of the message bubble - light gray (`#F3F4F6`) in light mode
  and dark gray (`#404040`) in dark mode.

- **outline**: there's a faint outline around the reaction bubble that matches the color of the
  background - white (`#FFFFFF`) in light mode and dark gray (`#1A1A1A`) in dark mode.

<img src="/group-chat-2/reactions.png" alt="reactions" />

once you account for orientation, color, theme, and reaction type, you end up with quite a few
unique svgs. to manage all these permutations, i wrote a function that takes in parameters like
sender, message owner, reaction type, and theme, then picks the correct svg from a folder of assets.

```typescript
const getReactionIconSvg = (
  messageFromMe: boolean,
  reactionType: ReactionType,
  reactionFromMe: boolean
) => {
  const orientation = messageFromMe ? "left" : "right";
  const variant = reactionFromMe
    ? effectiveTheme === "dark"
      ? "dark-blue"
      : "light-blue"
    : effectiveTheme === "dark"
    ? "dark"
    : "light";
  return `messages/reactions/${orientation}-${variant}-${reactionType}.svg`;
};
```

to make reactions pop onto the screen like they do in imessage, i added the following animations:

```css
@keyframes popIn {
  0% {
    transform: scale(0);
    opacity: 0;
  }
  70% {
    transform: scale(1.2);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.reaction-menu {
  animation: popIn 0.3s ease-out forwards;
  box-shadow: none;
  border: none;
}

.reaction-bubble {
  animation: fadeIn 0.2s ease-out forwards;
}
```

## mentions

originally, i thought i could just use a plain html `<input>` for typing messages, but sadly i was
mistaken. one of the details i was most excited to replicate was the ability to mention members of
the chat. imessage has a very specific, incredibly delightful way of displaying mentions. when you
type "@" then start typing the name of one of the members of the chat, the text changes to gray.
then, if it's a match, the text changes to blue with a little shimmer and bounce animation.

<div style={{ marginBlock: "1rem" }}>
  <video
    src="/group-chat-2/mention.mp4"
    autoPlay
    loop
    muted
    playsInline
    style={{ width: "100%", display: "block", borderRadius: "0.5rem" }}
  />
</div>

unfortunately, this type of interaction is hard to replicate in plain html, so i ended up using
[tiptap](https://tiptap.dev). tiptap's mention extension is set up to detect when the user types
‚Äú@‚Äù. then it:

- checks for a matching recipient by comparing the text after ‚Äú@‚Äù to a list of names
- auto-inserts a mention node if an exact match is found
- replaces the ‚Äú@name‚Äù text in the editor with a custom `<span>` that has special mention styling

this styling is managed in `tiptap.css`:

```css
/* suggestion styling */
.suggestion {
  color: #6b7280; /* gray-500 */
}

/* mention node styling */
.ProseMirror .mention-node {
  color: #0a7cff;
  font-weight: 500;
  position: relative;
  display: inline-block;
  background: #0a7cff -webkit-gradient(linear, 100% 0, 0 0, from(#0a7cff), color-stop(0.5, #ffffff), to(#0a7cff));
  background-position: -4rem top;
  background-repeat: no-repeat;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-size: 4rem 100%;
  transform-origin: bottom;
}

/* shimmer animation */
.ProseMirror .mention-node:not(.shimmer-done) {
  animation: shimmer 2.2s cubic-bezier(0.4, 0, 0.2, 1) forwards, bounce 2.2s cubic-bezier(
        0.4,
        0,
        0.2,
        1
      ) forwards;
  animation-iteration-count: 1, 1;
  animation-play-state: running;
  animation-fill-mode: forwards;
}
```

essentially:

- there's a linear gradient that transitions from blue to white to blue
- the gradient is clipped to the text with `-webkit-background-clip: text`
- the text itself is made transparent so the gradient shows through
- the shimmer animation moves the gradient across the text, making it look like it‚Äôs sparkling
- once the animation finishes, we apply a `.shimmer-done` class so it only plays when the mention is
  first added

another surprising challenge was handling multi-line messages in the message input. in imessage,
when your message goes beyond one line, the input gets taller, pushing the messages upward. handling
that in tiptap (or any rich text editor) requires some css trickery to dynamically increase the
height of the editor and decrease the size of the message list that sits above it so that the
viewport remains the same size.

<img src="/group-chat-2/input.png" alt="input" />

to implement this, we have a dynamic height adjustment system using css variables. it works as
follows:

- **dynamic height**: the message input component updates a css variable called `--dynamic-height`
  as the user types. this variable starts at 64px by default but grows as the input expands.
- **padding**: the message list container has padding at the bottom using
  `pb-[var(--dynamic-height,64px)]`. this ensures that as the input grows taller, the messages above
  get an equal amount of padding so they don't get hidden behind the expanding input.
- **scroll area**: the scroll area component uses `bottomMargin="calc(var(--dynamic-height, 64px))"`
  to ensure the scrollbar extends fully to the top of the input area, regardless of how tall it
  becomes. without this, the scrollbar would get cut off when the input grows.
- **absolute positioning**: the input is positioned absolutely at the bottom of the container
  `absolute bottom-0 left-0 right-0 z-50` with a height that matches the dynamic variable
  `h-[var(--dynamic-height,64px)]`.

this keeps everything aligned. when you add another line, the input automatically expands, the
messages move up, and the scroll area stays consistent, just like imessage.

## extra touches

beyond the core features of bubbles, mentions, and reactions, there were a few extra details that
helped complete the imessage illusion:

- **sound effects**: i pulled in the classic imessage notification sounds. shout out to
  [paul](https://x.com/pauldornier_) for the idea.
- **sidebar**: i recreated the sidebar with the same style and functionality (pinned convos, unread
  notifications, etc).
- **mobile view**: on mobile, the sidebar and chat area take up the entire screen when in view. i
  also created the contact drawer, which appears when you tap the recipients in the chat header.
- **blue cursor**: the cursor in the input is the same bright blue that you see in imessage.

none of these details were quite as complex to implement as the gradient bubbles or @-mention logic,
but each detail was crucial in nailing the imessage look.

## challenges & reflections

i love working on projects that push me to dissect how the interfaces i admire really work under the
hood. in many ways, this was one of the most challenging projects i‚Äôve tackled and i learned a ton
through it. in particular:

- **building ios-grade experiences for the web**  
  building a ui that looks and feels like imessage was tricky enough on desktop, but mobile added
  another layer of complexity. i‚Äôd often get a feature working great on desktop, then test on mobile
  only to find that something was totally off. in particular, the ios keyboard and scroll bars were
  a big challenge. i had to work around them in a number of ways to get the ui to behave even close
  to what i wanted.
- **wrestling with svgs**  
  this was my first time really using svgs in a project - and boy did i use them. the public folder
  has close to a hundred svgs of different variations. using them wasn‚Äôt so much hard as it was a
  game of shuffling assets around: hunting them down in the first place, manipulating their
  backgrounds and borders, exporting and importing them, fiddling with their positioning, and so on.
  it reinforced my belief that there are still so many manual workflows at the intersection of
  design and development that could be improved.
- **animations & the art of articulation**  
  the biggest challenge i faced with animations was honestly finding the right words to describe
  them to codegen tools like windsurf, chatgpt, or claude (or friends like eden and john). the
  mention animation, for example, was very hard to describe in words. i spend a good hour just
  playing around with imessage and studying what was actually happening before i could properly
  describe it. with all the progress that has been made in codegen tools to get to the point where
  "if you can speak it, you can build it", actually being able to articulate exactly what you want
  is an important skill.

a big thank you to [andy](https://x.com/andyzg3), [eden](https://x.com/eden_halperin),
[john](https://x.com/JohnPhamous), [justin](https://x.com/defaultalive),
[shreyas](https://x.com/66_shrey), & [paul](https://x.com/pauldornier_) for their help and feedback.

if you want to take a closer look at the code:

- **[**/components/chat-area.tsx**](https://github.com/alanagoyal/messages/blob/main/components/chat-area.tsx)**
  a top-level container that runs from the header to the message input at the bottom
- **[**/components/chat-header.tsx**](https://github.com/alanagoyal/messages/blob/main/components/chat-header.tsx)**
  the top part of the chat area, showing the participants and a search bar
- **[**/components/message-list.tsx**](https://github.com/alanagoyal/messages/blob/main/components/message-list.tsx)**
  the scrollable body, where messages and reactions appear
- **[**/components/message-input.tsx**](https://github.com/alanagoyal/messages/blob/main/components/message-input.tsx)**
  a text editor for typing new messages, including @-mentions

i‚Äôm pretty happy with how it turned out, but there‚Äôs still a lot of room for improvement. in
particular, i definitely cut a lot of corners on performance, accessability, and organization. if
you spot something i could do better or have an alternative approach to any of these effects, i‚Äôd
love to hear about it. reach out to me on [x](https://x.com/alanagoyal) or submit a pull request on
[github](https://github.com/alanagoyal/messages).
